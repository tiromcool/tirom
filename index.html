<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- ************* بخش جدید SEO ************* -->
    <title>سردخانه تیرم | نگهداری تخصصی محصولات کشاورزی در تنکابن - tiromcool</title>
    <meta name="description" content="سردخانه تیرم (مهندس سعید گلیجانی مقدم) ارائه دهنده خدمات نگهداری تخصصی میوه و محصولات کشاورزی در تنکابن، شهسوار، جاده کشکو. تماس: ۰۹۱۲۲۷۲۷۹۲۴.">
    <meta name="keywords" content="سردخانه تیرم, tiromcool, سردخانه تنکابن, سردخانه شهسوار, سردخانه میوه تنکابن, نگهداری محصولات کشاورزی مازندران, سردخانه گلیجانی مقدم, سعید پروانه">
    <!-- **************************************** -->

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* تنظیم فونت و تم رنگی */
        @import url('https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;700;900&display=swap');
        body {
            font-family: 'Vazirmatn', sans-serif;
            background-color: #f0f8ff; /* Light blue background */
        }
        .card-container {
            /* سایه بزرگ و شیک برای کارت اصلی */
            box-shadow: 0 20px 50px rgba(0, 70, 150, 0.25); 
            background: linear-gradient(135deg, #ffffff 50%, #f7fcff); /* Soft gradient */
        }
        .share-button {
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        }
        .share-button:hover {
            transform: translateY(-3px);
            /* سایه آبی رنگ برای دکمه */
            box-shadow: 0 10px 20px rgba(37, 99, 235, 0.5); 
        }
        .icon-link {
            transition: transform 0.2s, background-color 0.2s, box-shadow 0.3s, ring 0.2s;
        }
        .icon-link:hover {
            /* افکت مدرن: کمی حرکت و برجستگی نورانی */
            transform: translateX(3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1); 
        }
        .ltr-text {
            direction: ltr;
        }
    </style>
    <!-- آیکون‌های لوسید برای ظاهر مدرن -->
    <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body class="p-4 flex flex-col items-center min-h-screen">

    <div class="card-container w-full max-w-xl mx-auto rounded-3xl p-6 md:p-10 space-y-8 border-2 border-blue-300 shadow-2xl">

        <!-- بخش دکمه اشتراک‌گذاری بالا -->
        <button id="shareButtonTop" class="share-button w-full bg-blue-600 text-white p-4 rounded-2xl font-bold flex items-center justify-center gap-3 hover:bg-blue-700 focus:outline-none focus:ring-4 focus:ring-blue-300 text-xl tracking-wider shadow-xl shadow-blue-500/50">
            <i data-lucide="share-2" class="w-6 h-6"></i>
            اشتراک‌گذاری این کارت
        </button>

        <!-- بخش لوگو و عنوان -->
        <div class="text-center space-y-4">
            
            <!-- ********* لینک لوگوی سردخانه تیرم ********* -->
            <img src="https://i.ibb.co/pBWch21N/Screenshot-Gallery.png" 
                 alt="لوگوی سردخانه تیرم"
                 class="w-40 h-40 object-contain mx-auto rounded-full border-4 border-blue-400 p-2 shadow-2xl mb-4 bg-white"
                 style="aspect-ratio: 1/1;">
            <!-- ************************************************************************* -->

            <!-- استفاده از تگ h1 برای بالاترین اهمیت در سئو -->
            <h1 class="text-5xl font-extrabold text-blue-900 mt-2">سردخانه تیرم</h1>
            <p class="text-lg text-gray-600 border-b pb-4 border-blue-100">خدمات نوین نگهداری محصولات کشاورزی</p>
        </div>
        
        <!-- --- بخش نمایش بازدید امروز (جدید) --- -->
        <div id="visitorCounter" class="p-4 bg-yellow-100 rounded-xl shadow-inner border border-yellow-300 flex items-center justify-center gap-3">
            <i data-lucide="eye" class="w-6 h-6 text-yellow-700"></i>
            <span class="text-gray-800 font-bold">بازدید امروز:</span>
            <span id="visitsToday" class="text-2xl font-black text-yellow-800">...</span>
            <span class="text-gray-500 text-sm mr-2">نفر</span>
        </div>
        <!-- --------------------------------------- -->

        <!-- --- اطلاعات تماس (شروع بخش h2) --- -->
        <div class="space-y-4 pt-4 border-t border-blue-200">
            <h2 class="text-2xl font-extrabold text-blue-700 pb-2">اطلاعات تماس</h2>
            
            <!-- تلفن مدیر عامل - کارت کوچک مدرن -->
            <a href="tel:+989122727924" class="icon-link block p-4 bg-white hover:bg-blue-50 rounded-xl flex items-center justify-between shadow-lg border border-gray-100 hover:ring-2 hover:ring-blue-400">
                <div class="flex items-center gap-3">
                    <i data-lucide="user-check" class="w-7 h-7 text-indigo-600 flex-shrink-0"></i>
                    <div>
                        <p class="font-bold text-gray-800">مهندس سعید گلیجانی مقدم (مدیر عامل)</p>
                        <p class="text-blue-600 text-2xl font-black ltr-text" dir="ltr">+98 912 272 7924</p>
                    </div>
                </div>
                <i data-lucide="phone" class="w-7 h-7 text-blue-600 flex-shrink-0"></i>
            </a>

            <!-- تلفن دفتر - کارت کوچک مدرن -->
            <a href="tel:+989370454525" class="icon-link block p-4 bg-white hover:bg-blue-50 rounded-xl flex items-center justify-between shadow-lg border border-gray-100 hover:ring-2 hover:ring-blue-400">
                <div class="flex items-center gap-3">
                    <i data-lucide="clipboard-list" class="w-7 h-7 text-green-600 flex-shrink-0"></i>
                    <div>
                        <p class="font-bold text-gray-800">سعید پروانه (تلفن دفتر)</p>
                        <p class="text-blue-600 text-2xl font-black ltr-text" dir="ltr">+98 937 045 4525</p>
                    </div>
                </div>
                <i data-lucide="phone" class="w-7 h-7 text-blue-600 flex-shrink-0"></i>
            </a>
        </div>
        
        <!-- --- نشانی سردخانه --- -->
        <div class="space-y-4 pt-4 border-t border-blue-200">
            <h2 class="text-2xl font-extrabold text-blue-700 pb-2">نشانی سردخانه</h2>
            <!-- باکس آدرس - کارت کوچک مدرن -->
            <div class="p-5 bg-white rounded-xl border border-gray-100 shadow-lg flex items-start gap-3 transition hover:ring-2 hover:ring-blue-400">
                <i data-lucide="map-pin" class="w-7 h-7 text-red-500 mt-1 flex-shrink-0"></i>
                <p class="text-gray-700 leading-relaxed text-lg">
                    **تنکابن** ( شهسوار) جاده کشکو به **سلیمان آباد** ، جنب پل قریب و رودخانه **تیرم** ، **سردخانه تیرم** (**مقدم**) .
                </p>
            </div>
        </div>

        <!-- --- شبکه‌های اجتماعی و مسیریابی --- -->
        <div class="space-y-4 pt-4 border-t border-blue-200">
            <h2 class="text-2xl font-extrabold text-blue-700 pb-2">شبکه‌های اجتماعی و مسیریابی</h2>

            <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                <!-- اینستاگرام - کارت کوچک مدرن -->
                <a href="https://Instagram.com/tiromcool" target="_blank" class="icon-link flex items-center gap-3 p-3 rounded-xl bg-purple-100 hover:bg-purple-200 shadow-lg hover:ring-2 hover:ring-purple-400">
                    <i data-lucide="instagram" class="w-6 h-6 text-purple-600"></i>
                    <span class="font-medium text-gray-800 text-sm">صفحه رسمی اینستاگرام</span>
                </a>

                <!-- تلگرام - کارت کوچک مدرن -->
                <a href="https://tme/tiromcool" target="_blank" class="icon-link flex items-center gap-3 p-3 rounded-xl bg-blue-100 hover:bg-blue-200 shadow-lg hover:ring-2 hover:ring-blue-400">
                    <i data-lucide="send" class="w-6 h-6 text-blue-600"></i>
                    <span class="font-medium text-gray-800 text-sm">کانال تلگرام تیرم</span>
                </a>

                <!-- واتس اپ - کارت کوچک مدرن -->
                <a href="https://chat.whatsapp.com/LaBgSRtP8wxK0QZbe2SUME?mode=ems_wa_t" target="_blank" class="icon-link flex items-center gap-3 p-3 rounded-xl bg-green-100 hover:bg-green-200 shadow-lg hover:ring-2 hover:ring-green-400">
                    <i data-lucide="message-square" class="w-6 h-6 text-green-600"></i>
                    <span class="font-medium text-gray-800 text-sm">صفحه واتس اپ تیرم</span>
                </a>

                <!-- گوگل مپ - کارت کوچک مدرن -->
                <a href="https://maps.google.com/?cid=15309281493284918832&entry=gps" target="_blank" class="icon-link flex items-center gap-3 p-3 rounded-xl bg-gray-100 hover:bg-gray-200 shadow-lg hover:ring-2 hover:ring-red-400">
                    <i data-lucide="map" class="w-6 h-6 text-red-500"></i>
                    <span class="font-medium text-gray-800 text-sm">آدرس سردخانه روی گوگل مپ</span>
                </a>
            </div>
        </div>

        <!-- بخش دکمه اشتراک‌گذاری پایین -->
        <button id="shareButtonBottom" class="share-button w-full bg-blue-600 text-white p-4 rounded-2xl font-bold flex items-center justify-center gap-3 hover:bg-blue-700 focus:outline-none focus:ring-4 focus:ring-blue-300 text-xl tracking-wider shadow-xl shadow-blue-500/50">
            <i data-lucide="share-2" class="w-6 h-6"></i>
            اشتراک‌گذاری این کارت
        </button>

        <!-- بخش کپی رایت و طراح -->
        <div class="text-center pt-4 border-t border-blue-100">
            <p class="text-xs text-gray-500">
                طراحی توسط سعید پروانه : <a href="https://instagram.com/saeidparvaneh" target="_blank" class="text-blue-600 hover:text-blue-800 font-extrabold">@saeidparvaneh</a>
            </p>
        </div>

    </div>

    <!-- اسکریپت‌های جاوا اسکریپت و فایربیس -->
    <script type="module">
        // --------------------------------------------------------------------------------
        // 1. تنظیمات و توابع پایه فایربیس
        // --------------------------------------------------------------------------------
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, onSnapshot, setDoc, increment, serverTimestamp, getDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // تنظیمات فایربیس (محیط Canvas این متغیرها را فراهم می‌کند)
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        let app;
        let db;
        let auth;
        let userId = null;

        // تابع کمکی برای فرمت تاریخ به صورت YYYY-MM-DD
        function getTodayDateString() {
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        // تابع اصلی برای مقداردهی اولیه فایربیس
        async function initializeFirebase() {
            try {
                app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);

                // setLogLevel('debug'); // برای دیدن لاگ‌های فایربیس در کنسول

                // احراز هویت (Authentication)
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await signInAnonymously(auth);
                }

                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        userId = user.uid;
                        console.log('User signed in. UID:', userId);
                        
                        // پس از احراز هویت، شمارنده بازدید را آغاز کنید
                        updateVisitorCount();
                        startCounterListener();
                    } else {
                        console.log('No user signed in.');
                        // اگر احراز هویت نشد، همچنان سعی می‌کنیم بازدید رو ثبت کنیم
                        updateVisitorCount();
                        startCounterListener();
                    }
                });

            } catch (error) {
                console.error("خطا در مقداردهی اولیه فایربیس:", error);
                showNotification('خطا در اتصال به پایگاه داده.', 'error');
            }
        }

        // --------------------------------------------------------------------------------
        // 2. منطق شمارنده بازدید
        // --------------------------------------------------------------------------------

        const VISITS_COLLECTION = 'daily_visits';

        /**
         * مرجع سند شمارنده بازدید امروز را برمی‌گرداند.
         * مسیر: /artifacts/{appId}/public/data/daily_visits/{YYYY-MM-DD}
         */
        function getDailyVisitDocRef() {
            const today = getTodayDateString();
            const path = `/artifacts/${appId}/public/data/${VISITS_COLLECTION}/${today}`;
            return doc(db, path);
        }

        /**
         * شمارنده بازدید امروز را در فایربیس به صورت اتمی (Atomic) افزایش می‌دهد.
         */
        async function updateVisitorCount() {
            if (!db) return;

            const visitRef = getDailyVisitDocRef();
            const docData = {
                count: increment(1),
                lastUpdate: serverTimestamp()
            };

            try {
                // استفاده از setDoc با merge: true برای افزایش یا ایجاد سند در صورت عدم وجود
                await setDoc(visitRef, docData, { merge: true });
                console.log("شمارنده بازدید امروز با موفقیت افزایش یافت.");
            } catch (error) {
                console.error("خطا در افزایش شمارنده بازدید:", error);
            }
        }

        /**
         * به صورت لحظه‌ای به شمارنده بازدید امروز گوش می‌دهد و آن را در UI نمایش می‌دهد.
         */
        function startCounterListener() {
            if (!db) return;
            
            const visitRef = getDailyVisitDocRef();
            const visitsTodayElement = document.getElementById('visitsToday');

            // استفاده از onSnapshot برای دریافت به‌روزرسانی‌های لحظه‌ای
            onSnapshot(visitRef, (doc) => {
                if (doc.exists()) {
                    const data = doc.data();
                    const currentCount = data.count || 0;
                    visitsTodayElement.textContent = currentCount.toLocaleString('fa-IR'); // نمایش به فارسی
                } else {
                    // اگر هنوز سندی برای امروز ثبت نشده (احتمالا در لحظه اول)
                    visitsTodayElement.textContent = '۱'; 
                }
            }, (error) => {
                console.error("خطا در گوش دادن به شمارنده بازدید:", error);
                visitsTodayElement.textContent = 'خطا';
            });
        }

        // --------------------------------------------------------------------------------
        // 3. توابع عمومی و رویدادها
        // --------------------------------------------------------------------------------

        // فعال‌سازی آیکون‌های لوسید
        lucide.createIcons();

        // تابع اشتراک‌گذاری (همان توابع قبلی)
        function shareCard() {
            const title = "سردخانه تیرم - کارت ویزیت آنلاین";
            const text = `
سردخانه تیرم در تنکابن
مدیر عامل: مهندس سعید گلیجانی مقدم (+989122727924)
تلفن دفتر (سعید پروانه): (+989370454525)

آدرس: تنکابن (شهسوار)، جاده کشکو به سلیمان آباد، جنب پل قریب، سردخانه تیرم.

لینک کارت ویزیت کامل: ${window.location.href}
`;
            
            const shareData = {
                title: title,
                text: text,
                url: window.location.href,
            };

            if (navigator.share) {
                navigator.share(shareData)
                    .then(() => console.log('محتوا با موفقیت به اشتراک گذاشته شد.'))
                    .catch((error) => {
                        console.error('خطا در اشتراک‌گذاری:', error);
                        showNotification('اشتراک‌گذاری انجام نشد. می‌توانید لینک را کپی کنید.', 'error');
                    });
            } else {
                fallbackCopy(shareData.url, 'لینک کارت ویزیت در کلیپ‌بورد کپی شد.');
            }
        }

        function fallbackCopy(textToCopy, successMessage) {
            const tempInput = document.createElement('textarea');
            tempInput.style.position = 'absolute';
            tempInput.style.left = '-9999px';
            tempInput.value = textToCopy;
            document.body.appendChild(tempInput);
            tempInput.select();
            
            try {
                document.execCommand('copy'); 
                showNotification(successMessage, 'success');
            } catch (err) {
                console.error('کپی کردن ناموفق بود:', err);
                showNotification('خطا: کپی کردن با مشکل مواجه شد. لطفاً به صورت دستی کپی کنید.', 'error');
            }
            document.body.removeChild(tempInput);
        }

        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.textContent = message;
            notification.className = `fixed top-5 left-1/2 transform -translate-x-1/2 p-4 rounded-xl text-white shadow-xl transition-opacity duration-300 z-50`;
            
            if (type === 'success') {
                notification.classList.add('bg-green-600');
            } else if (type === 'error') {
                notification.classList.add('bg-red-600');
            } else {
                notification.classList.add('bg-gray-800');
            }

            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.opacity = '0';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // اتصال توابع به دکمه‌ها
        document.getElementById('shareButtonTop').addEventListener('click', shareCard);
        document.getElementById('shareButtonBottom').addEventListener('click', shareCard);

        // شروع مقداردهی اولیه فایربیس پس از بارگذاری کامل صفحه
        initializeFirebase();

    </script>
</body>
</html>

